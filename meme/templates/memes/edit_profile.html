{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="edit-profile-container">
    <div class="edit-profile-form">
        <h1>Редактировать профиль</h1>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Секция аватара -->
            <div class="avatar-section">
                <div class="avatar-preview">
                    {% if user.profile.avatar %}
                        <img src="{{ user.profile.avatar.url }}" alt="Аватар">
                    {% else %}
                        <div class="avatar-initials">
                            {{ user.username|first|upper }}
                        </div>
                    {% endif %}
                </div>

                <div class="avatar-upload">
                    <input type="file" name="avatar" accept="image/*" id="avatar-upload" onchange="previewAvatar(this)">
                    <label for="avatar-upload" class="upload-button">
                        {% if user.profile.avatar %}Изменить аватар{% else %}Загрузить аватар{% endif %}
                    </label>
                    <p class="upload-hint">Рекомендуемый размер: 400×400px</p>
                </div>
            </div>

            <!-- Основные поля формы -->
            <div class="form-fields">
                <div class="form-group">
                    <label>Имя пользователя</label>
                    <input type="text" name="username" value="{{ user.username }}" required>
                </div>

                <div class="form-group">
                    <label>Почта</label>
                    <input type="email" name="email" value="{{ user.email }}" required>
                </div>
            </div>

            <!-- Кнопки действий -->
            <div class="form-actions">
                <button type="button" onclick="window.history.back()" class="cancel-button">
                    Отмена
                </button>
                <button type="submit" class="save-button">
                    Сохранить изменения
                </button>
            </div>
        </form>
    </div>
</div>

<style>
.edit-profile-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 40px;
}

.edit-profile-form {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: 24px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.08);
    padding: 40px;
}

.edit-profile-form h1 {
    font-size: 32px;
    font-weight: bold;
    color: #2d3748;
    margin-bottom: 30px;
    text-align: center;
}

.avatar-section {
    display: flex;
    align-items: center;
    gap: 30px;
    margin-bottom: 30px;
}

.avatar-preview {
    width: 150px;
    height: 150px;
    border-radius: 20px;
    overflow: hidden;
    background: {% if user.profile.avatar %}transparent{% else %}linear-gradient(135deg, #4299e1 0%, #9f7aea 100%){% endif %};
    display: flex;
    align-items: center;
    justify-content: center;
}

.avatar-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-initials {
    color: white;
    font-size: 60px;
    font-weight: bold;
}

.avatar-upload {
    flex: 1;
}

#avatar-upload {
    display: none;
}

.upload-button {
    display: inline-block;
    background: #4299e1;
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 500;
    text-align: center;
    transition: background 0.2s ease;
    cursor: pointer;
}

.upload-button:hover {
    background: #3182ce;
}

.upload-hint {
    font-size: 14px;
    color: #718096;
    margin-top: 8px;
}

.form-fields {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 30px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: #4a5568;
    margin-bottom: 8px;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    font-size: 16px;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.form-actions {
    display: flex;
    gap: 15px;
}

.cancel-button {
    flex: 1;
    background: #e2e8f0;
    color: #4a5568;
    padding: 14px 28px;
    border-radius: 8px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: background 0.2s ease;
}

.cancel-button:hover {
    background: #cbd5e0;
}

.save-button {
    flex: 1;
    background: #4299e1;
    color: white;
    padding: 14px 28px;
    border-radius: 8px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: background 0.2s ease;
}

.save-button:hover {
    background: #3182ce;
}
</style>

<script>
function previewAvatar(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const avatarDiv = document.querySelector('.avatar-preview');
            avatarDiv.innerHTML = `<img src="${e.target.result}" alt="Аватар" style="width: 100%; height: 100%; object-fit: cover;">`;

            const label = document.querySelector('label[for="avatar-upload"]');
            label.textContent = 'Изменить аватар';
        };
        reader.readAsDataURL(input.files[0]);
    }
}
</script>
{% endblock %}
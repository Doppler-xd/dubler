{% extends "base.html" %}
{% load static %}

{% block content %}
<div style="
    min-height: 100vh;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
">

    <!-- Шапка страницы профиля -->
    <header style="
        position: sticky;
        top: 0;
        z-index: 50;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid #e2e8f0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    ">
        <div style="
            max-width: 1200px;
            margin: 0 auto;
            padding: 12px 20px;
        ">
            <div style="
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                gap: 12px;
            ">
                <a
                    href="{% url 'memes:home' %}"
                    style="
                        color: #4a5568;
                        font-weight: 500;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        text-decoration: none;
                        transition: color 0.2s ease;
                    "
                    onmouseover="this.style.color='#4299e1'"
                    onmouseleave="this.style.color='#4a5568'"
                >
                    <div style="
                        padding: 6px;
                        border-radius: 8px;
                        background: #f7fafc;
                        transition: background 0.2s ease;
                    ">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </div>
                    <span>Главная страница</span>
                </a>
                <h1 style="
                    font-size: 24px;
                    font-weight: bold;
                    color: #2d3748;
                ">
                    Профиль
                </h1>
                <a
                    href="{% url 'memes:editor_new' %}"
                    style="
                        background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
                        color: white;
                        padding: 10px 20px;
                        border-radius: 12px;
                        font-weight: 500;
                        text-decoration: none;
                        transition: all 0.3s ease;
                        transform: translateY(0);
                        box-shadow: 0 10px 20px rgba(66, 153, 225, 0.3);
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    "
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 15px 30px rgba(66, 153, 225, 0.4)'"
                    onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 20px rgba(66, 153, 225, 0.3)'"
                >
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Создать мем
                </a>
            </div>
        </div>
    </header>

    <!-- Основной контент профиля -->
    <div style="
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px 20px;
    ">
        <div style="
            max-width: 1024px;
            margin: 0 auto;
        ">

            <!-- Заголовок профиля -->
            <div style="
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.08);
                padding: 30px;
                margin-bottom: 30px;
            ">
                <div style="
                    display: flex;
                    flex-direction: row;
                    align-items: center;
                    gap: 30px;
                ">
                    <!-- Аватар -->
                    <div style="
                        width: 150px;
                        height: 150px;
                        border-radius: 20px;
                        overflow: hidden;
                        background: {% if user.profile.avatar %}transparent{% else %}linear-gradient(135deg, #4299e1 0%, #9f7aea 100%){% endif %};
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        flex-shrink: 0;
                    ">
                        {% if user.profile.avatar %}
                            <img
                                src="{{ user.profile.avatar.url }}"
                                alt="Аватар {{ user.username }}"
                                style="width: 100%; height: 100%; object-fit: cover;"
                            >
                        {% else %}
                            <div style="
                                color: white;
                                font-size: 60px;
                                font-weight: bold;
                            ">
                                {{ user.username|first|upper }}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Информация о пользователе -->
                    <div style="flex: 1;">
                        <h2 style="
                            font-size: 32px;
                            font-weight: bold;
                            color: #2d3748;
                            margin-bottom: 10px;
                        ">
                            {{ user.username }}
                        </h2>

                        {% if user.email %}
                        <div style="
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            margin-bottom: 10px;
                            color: #718096;
                            font-size: 14px;
                        ">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            <span>{{ user.email }}</span>
                        </div>
                        {% endif %}

                        {% if user.profile.bio %}
                        <p style="
                            color: #4a5568;
                            line-height: 1.6;
                            margin-top: 15px;
                        ">
                            {{ user.profile.bio }}
                        </p>
                        {% endif %}

                        <div style="
                            display: flex;
                            gap: 15px;
                            margin-top: 25px;
                        ">
                            <a
                                href="{% url 'memes:edit_profile' %}"
                                style="
                                    background: #4299e1;
                                    color: white;
                                    padding: 12px 24px;
                                    border-radius: 8px;
                                    font-weight: 500;
                                    text-decoration: none;
                                    transition: background 0.2s ease;
                                    display: inline-flex;
                                    align-items: center;
                                    gap: 8px;
                                "
                                onmouseover="this.style.background='#3182ce'"
                                onmouseleave="this.style.background='#4299e1'"
                            >
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                                Редактировать профиль
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Мемы пользователя -->
            <div style="
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.08);
                padding: 30px;
            ">
                <div style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 30px;
                ">
                    <h3 style="
                        font-size: 24px;
                        font-weight: bold;
                        color: #2d3748;
                    ">
                        Мои мемы
                    </h3>
                    <a
                        href="{% url 'memes:gallery' %}"
                        style="
                            color: #4299e1;
                            font-weight: 500;
                            text-decoration: none;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        "
                    >
                        Создать новый
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                    </a>
                </div>

                {% if mems %}
                <div style="
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                    gap: 20px;
                ">
                    {% for meme in mems %}
                    <div style="
                        border: 1px solid #e2e8f0;
                        border-radius: 12px;
                        overflow: hidden;
                        transition: all 0.3s ease;
                        background: white;
                    "
                    onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 10px 25px rgba(0,0,0,0.1)'"
                    onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                    >
                        {% if meme.template %}
                        <div style="position: relative; height: 200px; overflow: hidden;">
                            <img
                                src="{{ meme.template.image.url }}"
                                alt="{{ meme.name }}"
                                style="width: 100%; height: 100%; object-fit: cover;"
                            >
                            <div style="
                                position: absolute;
                                top: 0;
                                left: 0;
                                right: 0;
                                bottom: 0;
                                background: linear-gradient(to bottom, transparent 70%, rgba(0,0,0,0.5) 100%);
                            "></div>
                        </div>
                        {% elif meme.custom_image %}
                        <div style="position: relative; height: 200px; overflow: hidden;">
                            <img
                                src="{{ meme.custom_image.url }}"
                                alt="{{ meme.name }}"
                                style="width: 100%; height: 100%; object-fit: cover;"
                            >
                            <div style="
                                position: absolute;
                                top: 0;
                                left: 0;
                                right: 0;
                                bottom: 0;
                                background: linear-gradient(to bottom, transparent 70%, rgba(0,0,0,0.5) 100%);
                            "></div>
                        </div>
                        {% endif %}

                        <div style="padding: 20px;">
                            <h4 style="
                                font-size: 16px;
                                font-weight: 600;
                                color: #2d3748;
                                margin-bottom: 8px;
                            ">
                                {{ meme.name|default:"Без названия" }}
                            </h4>

                            <p style="
                                color: #718096;
                                font-size: 12px;
                                margin-bottom: 15px;
                            ">
                                Создан: {{ meme.created_at|date:"d.m.Y H:i" }}
                            </p>

                            <div style="
                                display: flex;
                                gap: 10px;
                            ">
                                {% if meme.template %}
                                <a
                                    href="{% url 'memes:editor_with_template' meme.template.id %}"
                                    style="
                                        flex: 1;
                                        background: #4299e1;
                                        color: white;
                                        padding: 8px 12px;
                                        border-radius: 6px;
                                        font-size: 14px;
                                        font-weight: 500;
                                        text-decoration: none;
                                        text-align: center;
                                        transition: background 0.2s ease;
                                    "
                                    onmouseover="this.style.background='#3182ce'"
                                    onmouseleave="this.style.background='#4299e1'"
                                >
                                    Редактировать
                                </a>
                                {% else %}
                                <a
                                    href="{{ meme.custom_image.url }}"
                                    download
                                    style="
                                        flex: 1;
                                        background: #48bb78;
                                        color: white;
                                        padding: 8px 12px;
                                        border-radius: 6px;
                                        font-size: 14px;
                                        font-weight: 500;
                                        text-decoration: none;
                                        text-align: center;
                                        transition: background 0.2s ease;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        gap: 6px;
                                    "
                                    onmouseover="this.style.background='#38a169'"
                                    onmouseleave="this.style.background='#48bb78'"
                                    title="Скачать мем"
                                >
                                    <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    Скачать
                                </a>
                                {% endif %}

                                <form
                                    method="POST"
                                    action="{% url 'memes:delete_meme' meme.id %}"
                                    style="flex: 1;"
                                    onsubmit="return confirm('Вы уверены, что хотите удалить этот мем?')"
                                >
                                    {% csrf_token %}
                                    <button
                                        type="submit"
                                        style="
                                            width: 100%;
                                            background: #fc8181;
                                            color: white;
                                            padding: 8px 12px;
                                            border-radius: 6px;
                                            font-size: 14px;
                                            font-weight: 500;
                                            border: none;
                                            cursor: pointer;
                                            transition: background 0.2s ease;
                                        "
                                        onmouseover="this.style.background='#f56565'"
                                        onmouseleave="this.style.background='#fc8181'"
                                    >
                                        Удалить
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div style="
                    text-align: center;
                    padding: 40px 20px;
                    color: #718096;
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: #f7fafc;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin: 0 auto 20px;
                    ">
                        <svg width="40" height="40" fill="none" stroke="#a0aec0" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <h4 style="
                        font-size: 18px;
                        font-weight: 500;
                        margin-bottom: 10px;
                        color: #4a5568;
                    ">
                        У вас пока нет созданных мемов
                    </h4>
                    <p style="margin-bottom: 20px; color: #718096;">
                        Создайте свой первый мем и он появится здесь
                    </p>
                    <a
                        href="{% url 'memes:gallery' %}"
                        style="
                            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
                            color: white;
                            padding: 12px 24px;
                            border-radius: 8px;
                            font-weight: 500;
                            text-decoration: none;
                            transition: all 0.3s ease;
                            transform: translateY(0);
                            box-shadow: 0 10px 20px rgba(66, 153, 225, 0.3);
                            display: inline-block;
                        "
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 15px 30px rgba(66, 153, 225, 0.4)'"
                        onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 20px rgba(66, 153, 225, 0.3)'"
                    >
                        Создать первый мем
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Футер -->
    <footer style="
        margin-top: 32px;
        padding: 24px 0;
        border-top: 1px solid #e2e8f0;
        background: rgba(255, 255, 255, 0.5);
    ">
        <div style="
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        ">
            <div style="
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                gap: 16px;
            ">
                <div style="
                    color: #718096;
                    font-size: 14px;
                ">
                    © 2024 B52 Memes. Все права защищены.
                </div>
                <div style="display: flex; gap: 24px;">
                    <a href="{% url 'memes:home' %}" style="
                        color: #718096;
                        font-size: 14px;
                        text-decoration: none;
                        transition: color 0.2s ease;
                    ">Главная</a>
                    <a href="{% url 'memes:gallery' %}" style="
                        color: #718096;
                        font-size: 14px;
                        text-decoration: none;
                        transition: color 0.2s ease;
                    ">Галерея</a>
                    <a href="{% url 'memes:user_memes' %}" style="
                        color: #718096;
                        font-size: 14px;
                        text-decoration: none;
                        font-weight: 500;
                        transition: color 0.2s ease;
                    ">Мои мемы</a>
                </div>
            </div>
        </div>
    </footer>
</div>

<script>
function downloadMeme(url, name) {
    const link = document.createElement('a');
    link.href = url;
    link.download = name || 'meme.png';

    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    alert('Мем начал скачиваться!');
}

document.addEventListener('DOMContentLoaded', function() {
    const downloadButtons = document.querySelectorAll('a[download]');
    downloadButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            const memeName = this.closest('.meme-card').querySelector('.meme-name').textContent;
            downloadMeme(this.href, memeName);
        });
    });
});
</script>
{% endblock %}